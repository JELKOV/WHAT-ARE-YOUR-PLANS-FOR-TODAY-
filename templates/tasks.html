{% extends 'base.html' %}

{% block title %}
Tasks - To-Do App
{% endblock %}

{% block content %}
<h2>ì˜¤ëŠ˜ì˜ í• ì¼</h2>

<!-- ë‚ ì§œ ì„ íƒ -->
<div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
    <span style="font-size: 1.1em; font-weight: bold;">ì˜¤ëŠ˜: {{ current_date }} ({{ weekday }})</span>
    <button class="date-btn" onclick="alert('ë‚ ì§œ ì„ íƒ ê¸°ëŠ¥ì€ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤!')">ë‚ ì§œ ì„ íƒ</button>
</div>

<!-- í• ì¼ ëª©ë¡ -->
<ul class="task-list">
    {% for task in tasks %}
        <li class="task-item
                   {% if task.deadline and task.deadline.strftime('%Y-%m-%d') == current_date and not task.completed %}due-today{% endif %}">
            <div class="task-content">
                <!-- ì²´í¬ë°•ìŠ¤ -->
                <input type="checkbox" class="task-checkbox" data-task-id="{{ task.id }}" {% if task.completed %}checked{% endif %}>

                <!-- í•  ì¼ ì œëª© -->
                <a href="{{ url_for('tasks.task_detail', task_id=task.id) }}" class="task-title">{{ task.title }}</a>

                <!-- ë§ˆê° ê¸°ì¼ í‘œì‹œ -->
                <span class="task-deadline">
                    ğŸ—“ï¸ ë§ˆê°: {{ task.deadline.strftime('%Y-%m-%d') if task.deadline else 'ì„¤ì • ì—†ìŒ' }}
                </span>

                <!-- ì§„í–‰ ìƒíƒœ -->
                <span class="task-status">{% if task.completed %}âœ… ì™„ë£Œë¨{% else %}â³ ì§„í–‰ ì¤‘{% endif %}</span>
            </div>

            <!-- ì‘ì—… ë²„íŠ¼ -->
            <div class="task-actions">
                <form action="{{ url_for('tasks.edit_task', task_id=task.id) }}" method="get" class="task-form">
                    <button type="submit" class="task-btn edit">ìˆ˜ì •</button>
                </form>
                <form action="{{ url_for('tasks.delete_task', task_id=task.id) }}" method="post" class="task-form">
                    <button type="submit" class="task-btn delete" onclick="return confirm('ì •ë§ë¡œ ì‚­ì œí•˜ê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
                </form>
            </div>
        </li>
    {% endfor %}
</ul>


<!-- í• ì¼ ì¶”ê°€ ë²„íŠ¼ -->
<a href="{{ url_for('tasks.add_task') }}" class="add-btn">í• ì¼ ì¶”ê°€</a>

<script>
    document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            fetch(`/tasks/update_status/${this.dataset.taskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ completed: this.checked })
            }).then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            });
        });
    });
</script>

{% endblock %}
