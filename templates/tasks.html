{% extends 'base.html' %}

{% block title %}
Tasks - To-Do App
{% endblock %}

{% block content %}
<h2>오늘의 할일</h2>

<!-- 날짜 선택 -->
<div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
    <span style="font-size: 1.1em; font-weight: bold;">오늘: {{ current_date }} ({{ weekday }})</span>
    <button class="date-btn" onclick="alert('날짜 선택 기능은 구현 중입니다!')">날짜 선택</button>
</div>

<!-- 할일 목록 -->
<ul>
    {% for task in tasks %}
        <li class="task-item">
            <div class="task-info">
                <input type="checkbox" class="task-checkbox" data-task-id="{{ task.id }}" {% if task.completed %}checked{% endif %}>
                <strong>{{ task.title }}</strong>
                <span class="task-status">{% if task.completed %}✅ 완료됨{% else %}⏳ 진행 중{% endif %}</span>
            </div>
            <div class="task-actions">
                <!-- 수정 버튼 -->
                <form action="{{ url_for('tasks.edit_task', task_id=task.id) }}" method="get">
                    <button type="submit" class="task-btn edit">수정</button>
                </form>
                <!-- 삭제 버튼 -->
                <form action="{{ url_for('tasks.delete_task', task_id=task.id) }}" method="post">
                    <button type="submit" class="task-btn delete" onclick="return confirm('정말로 삭제하겠습니까?')">삭제</button>
                </form>
            </div>
        </li>
    {% endfor %}
</ul>


<!-- 할일 추가 버튼 -->
<a href="{{ url_for('tasks.add_task') }}" class="add-btn">할일 추가</a>

<script>
    document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            fetch(`/tasks/update_status/${this.dataset.taskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ completed: this.checked })
            }).then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('업데이트에 실패했습니다.');
                }
            });
        });
    });
</script>

{% endblock %}
